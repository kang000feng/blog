<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
















  <meta name="baidu-site-verification" content="GSNdZByC4d">











<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=6.7.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/title2.ico?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/title2.ico?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/title2.ico?v=6.7.0">


  <link rel="mask-icon" href="/images/title2.ico?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.7.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  



  <meta name="description" content="前言在成功搭建好k8s集群后，我们接下来先运行一个简单的应用。在这个过程中了解一下把一个项目部署至k8s集群的过程。 系统准备首先，我们所准备的系统也很简单，是我之前用spring boot写的一个很简单的留言板系统。你也可以用自己开发的系统来代替，不过前提是可以进行容器化改造并且你对这个过程比较熟悉，那么可以参考下面的说明来把自己的系统打包成镜像。 当然，你也可以直接使用我的系统来部署，下面给出">
<meta name="keywords" content="Kubernetes,Pod,Deployment,Service">
<meta property="og:type" content="article">
<meta property="og:title" content="在k8s集群上运行你的应用">
<meta property="og:url" content="https://blog.icedsoul.cn/kubernetes-3.html">
<meta property="og:site_name" content="桐小木">
<meta property="og:description" content="前言在成功搭建好k8s集群后，我们接下来先运行一个简单的应用。在这个过程中了解一下把一个项目部署至k8s集群的过程。 系统准备首先，我们所准备的系统也很简单，是我之前用spring boot写的一个很简单的留言板系统。你也可以用自己开发的系统来代替，不过前提是可以进行容器化改造并且你对这个过程比较熟悉，那么可以参考下面的说明来把自己的系统打包成镜像。 当然，你也可以直接使用我的系统来部署，下面给出">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://img.icedsoul.cn/img/blog/kubernetes03/1.png">
<meta property="og:updated_time" content="2019-08-07T11:54:12.515Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="在k8s集群上运行你的应用">
<meta name="twitter:description" content="前言在成功搭建好k8s集群后，我们接下来先运行一个简单的应用。在这个过程中了解一下把一个项目部署至k8s集群的过程。 系统准备首先，我们所准备的系统也很简单，是我之前用spring boot写的一个很简单的留言板系统。你也可以用自己开发的系统来代替，不过前提是可以进行容器化改造并且你对这个过程比较熟悉，那么可以参考下面的说明来把自己的系统打包成镜像。 当然，你也可以直接使用我的系统来部署，下面给出">
<meta name="twitter:image" content="http://img.icedsoul.cn/img/blog/kubernetes03/1.png">






  <link rel="canonical" href="https://blog.icedsoul.cn/kubernetes-3.html">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>在k8s集群上运行你的应用 | 桐小木</title>
  






  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ef054124ba894c986045305810831295";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">桐小木</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">IcedSoul's Blog</h1>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于作者</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-acg">

    
    
    
      
    

    

    <a href="/acg/" rel="section"><i class="menu-item-icon fa fa-fw fa-television"></i> <br>动漫杂谈</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-wiki">

    
    
    
      
    

    

    <a href="https://wiki.icedsoul.cn" rel="noopener" target="_blank"><i class="menu-item-icon fa fa-fw fa-wikipedia-w"></i> <br>wiki</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.icedsoul.cn/kubernetes-3.html">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="IcedSoul">
      <meta itemprop="description" content="Nothing here">
      <meta itemprop="image" content="/images/icon.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="桐小木">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">在k8s集群上运行你的应用

              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-08-07 19:54:12" itemprop="dateCreated datePublished" datetime="2019-08-07T19:54:12+08:00">2019-08-07</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Kubernetes/" itemprop="url" rel="index"><span itemprop="name">Kubernetes</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          
            <span id="/kubernetes-3.html" class="leancloud_visitors" data-flag-title="在k8s集群上运行你的应用">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              
                <span class="post-meta-item-text">阅读次数：</span>
              
                <span class="leancloud-visitors-count"></span>
            </span>
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">9.8k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">16 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在成功搭建好k8s集群后，我们接下来先运行一个简单的应用。在这个过程中了解一下把一个项目部署至k8s集群的过程。</p>
<h2 id="系统准备"><a href="#系统准备" class="headerlink" title="系统准备"></a>系统准备</h2><p>首先，我们所准备的系统也很简单，是我之前用spring boot写的一个很简单的留言板系统。你也可以用自己开发的系统来代替，不过前提是可以进行容器化改造并且你对这个过程比较熟悉，那么可以参考下面的说明来把自己的系统打包成镜像。</p>
<p>当然，你也可以直接使用我的系统来部署，下面给出的配置文件在项目中都有，可以对照作为参考。</p>
<p>项目地址：<a href="https://github.com/IcedSoul/LeaveWord/tree/k8s" target="_blank" rel="noopener">LeaveWord</a></p>
<p>这个项目之前只是一个非常简单的Spring Boot项目，需要使用MySQL数据库。它根本算不上一个微服务系统，但是这不重要，我们就以这个项目为例来将其部署至k8s集群。</p>
<p>首先，先把leaveword的数据库链接地址修改为：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  datasource:</span></span><br><span class="line"><span class="attr">    driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">    url:</span> <span class="attr">jdbc:mysql://leaveword-mysql-service:3306/leaveword?characterEncoding=utf8&amp;useSSL=false</span></span><br><span class="line"><span class="attr">    username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">    password:</span> <span class="string">root</span></span><br></pre></td></tr></table></figure>
<p>其中，leaveword-mysql-service为我们等会儿要为leaveword新建的mysql的service名字，用户名和密码都为默认值。</p>
<p>接下来，就需要把项目打包为镜像然后上传至DockerHub或者私有镜像仓库了，此处我选择将其上传至DockerHub。</p>
<p>首先，添加Dockerfile以构建镜像</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> java:<span class="number">8</span>-jre</span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span> ./target/leaveword-0.0.1-SNAPSHOT.jar /app/</span><br><span class="line">CMD ["java", "-Xmx200m", "-jar", "/app/leaveword-0.0.1-SNAPSHOT.jar"]</span><br><span class="line"></span><br><span class="line">EXPOSE 8081</span><br></pre></td></tr></table></figure>
<p>注意，上面jar包名字和路径都应以自己的项目为准。</p>
<p>接下来，执行maven打包命令生成jar包。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean package -DskipTests</span><br></pre></td></tr></table></figure>
<p>接下来就是使用docker打包并上传镜像：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> 注意-t后面为[DockerHub UserName/Repository Name:Version],注意修改为自己的，且不要忘记最后的 .</span><br><span class="line">docker build -t icedsoul/leaveword:latest .</span><br><span class="line"><span class="meta">#</span> 登录自己的DockerHub账号，没有需要先去注册</span><br><span class="line">docker login</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> 把镜像上传至DockerHub仓库</span><br><span class="line">docker push icedsoul/leaveword:latest</span><br></pre></td></tr></table></figure>
<h2 id="项目部署运行"><a href="#项目部署运行" class="headerlink" title="项目部署运行"></a>项目部署运行</h2><p>在准备好镜像之后，我们可以开始准备在集群上部署此项目。在第一篇博客中我们已经了解到Pod和各种常见的Controller的概念，首先我们来尝试一下使用最常见的Deployment来创建Pod。</p>
<h3 id="创建Mysql的Pod和Service"><a href="#创建Mysql的Pod和Service" class="headerlink" title="创建Mysql的Pod和Service"></a>创建Mysql的Pod和Service</h3><p>根据上面的需求，我们需要创建的服务一共有两个，一个是Mysql，一个是LeaveWord，我们先来通过Deplyment创建Mysql，在Master节点上创建一个文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir leaveword</span><br><span class="line">vi leaveword/leaveword-mysql-deployment.yaml</span><br></pre></td></tr></table></figure>
<p>复制粘贴以下内容：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">leaveword-mysql</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">    replicas:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">    strategy:</span></span><br><span class="line"><span class="attr">        type:</span> <span class="string">Recreate</span></span><br><span class="line"><span class="attr">    template:</span></span><br><span class="line"><span class="attr">        metadata:</span></span><br><span class="line"><span class="attr">            labels:</span></span><br><span class="line"><span class="attr">                database:</span> <span class="string">leaveword-mysql</span></span><br><span class="line"><span class="attr">        spec:</span></span><br><span class="line"><span class="attr">            containers:</span></span><br><span class="line"><span class="attr">            - args:</span></span><br><span class="line"><span class="bullet">              -</span> <span class="bullet">--character-set-server=utf8mb4</span></span><br><span class="line"><span class="bullet">              -</span> <span class="bullet">--collation-server=utf8mb4_unicode_ci</span></span><br><span class="line"><span class="attr">              env:</span></span><br><span class="line"><span class="attr">              - name:</span> <span class="string">MYSQL_DATABASE</span></span><br><span class="line"><span class="attr">                value:</span> <span class="string">leaveword</span></span><br><span class="line"><span class="attr">              - name:</span> <span class="string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line"><span class="attr">                value:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">              image:</span> <span class="attr">mysql:5.6</span></span><br><span class="line"><span class="attr">              name:</span> <span class="string">leaveword-mysql</span></span><br><span class="line"><span class="attr">              ports:</span></span><br><span class="line"><span class="attr">              - containerPort:</span> <span class="number">3306</span></span><br></pre></td></tr></table></figure>
<p>以上就是deployment文件的格式，其具体含义在下面我们会一一解释，我们先根据这个文件创建对应的Pod。其中指定了Pod的副本数量，容器，镜像，启动参数等内容。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f leaveword/leaveword-mysql-deployment.yaml</span><br></pre></td></tr></table></figure>
<p>稍等片刻，使用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods</span><br></pre></td></tr></table></figure>
<p>查看Pod状态，如果正常会显示以下内容：</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NAME              READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">leaveword-mysql   1/1     1            1           4m10s</span><br></pre></td></tr></table></figure>
<p>如果没有显示READY说明正在拉取镜像，不用着急，稍等几分钟即可。</p>
<p>但是只有Pod并不能对外提供服务，我们还需要定义一下Service才能让其它服务能够访问Pod。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi leaveword/leaveword-mysql-service.yaml</span><br></pre></td></tr></table></figure>
<p>复制粘贴一下内容：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">group-mysql</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">"3306"</span></span><br><span class="line"><span class="attr">      port:</span> <span class="number">3306</span></span><br><span class="line"><span class="attr">      targetPort:</span> <span class="number">3306</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    database:</span> <span class="string">leaveword-mysql</span></span><br></pre></td></tr></table></figure>
<p>标签同样之后再解释，这个文件定义了service的name，关联的pod，开放的端口等等。接下来创建对应的Service：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f leaveword/leaveword-mysql-service.yaml</span><br></pre></td></tr></table></figure>
<p>然后执行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get services</span><br></pre></td></tr></table></figure>
<p>查看启动的service的状态。</p>
<h3 id="创建Leaveword的Pod和Service"><a href="#创建Leaveword的Pod和Service" class="headerlink" title="创建Leaveword的Pod和Service"></a>创建Leaveword的Pod和Service</h3><p>mysql的Pod和Service启动之后，我们也把leaveword的Pod给启动起来：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi leaveword/leaveword-deployment.yaml</span><br></pre></td></tr></table></figure>
<p>复制粘贴一下内容：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">leaveword</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">leaveword</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">        - image:</span> <span class="string">icedsoul/leaveword</span></span><br><span class="line"><span class="attr">          name:</span> <span class="string">leaveword</span></span><br><span class="line"><span class="attr">          ports:</span></span><br><span class="line"><span class="attr">            - containerPort:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">      restartPolicy:</span> <span class="string">Always</span></span><br></pre></td></tr></table></figure>
<p>接下来创建Pod：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f leaveword/leaveword-deployment.yaml</span><br></pre></td></tr></table></figure>
<p>稍等几分钟后，查看pod即可看到所有Pod正常运行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get pods</span><br><span class="line">NAME                               READY   STATUS    RESTARTS   AGE</span><br><span class="line">leaveword-6d686d9889-f55kq         1/1     Running   0          22s</span><br><span class="line">leaveword-6d686d9889-khg95         1/1     Running   0          22s</span><br><span class="line">leaveword-6d686d9889-ptbgp         1/1     Running   0          22s</span><br><span class="line">leaveword-mysql-57f7c65b77-kth9n   1/1     Running   0          63m</span><br></pre></td></tr></table></figure>
<p>之后，继续创建leaveword对应的Service：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi leaveword/leaveword-service.yaml</span><br></pre></td></tr></table></figure>
<p>然后粘贴以下内容：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">leaveword-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">NodePort</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">"8081"</span></span><br><span class="line"><span class="attr">      port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">      targetPort:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">      nodePort:</span> <span class="number">30001</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">leaveword</span></span><br></pre></td></tr></table></figure>
<p>接下来，执行创建命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f leaveword/leaveword-service.yaml</span><br></pre></td></tr></table></figure>
<p>查看所有Service：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get service</span><br><span class="line">NAME                      TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">kubernetes                ClusterIP   10.96.0.1      &lt;none&gt;        443/TCP          25h</span><br><span class="line">leaveword-mysql-service   ClusterIP   10.99.108.17   &lt;none&gt;        3306/TCP         59m</span><br><span class="line">leaveword-service         NodePort    10.107.6.254   &lt;none&gt;        8081:30001/TCP   7s</span><br></pre></td></tr></table></figure>
<p>其中kubernetes是集群的服务，leaveword-mysql-service和leave-service是我们所创建的的服务，并且我们可以看到leaveword-service端口暴露在了30001端口。我们可以通过集群Masterde IP+30001来访问主页：</p>
<p><img src="http://img.icedsoul.cn/img/blog/kubernetes03/1.png" alt="01"></p>
<p>到此为止，我们成功把一个单体项目和MySQL数据库部署到了k8s集群，并且成功访问到了项目。</p>
<p>但是Deployment的参数代表着什么意思，可以做怎样的调整，Service的文件的参数又是什么意思，又是怎么和Deployment创建的Pod关联起来的？</p>
<p>下面我们先来仔细看一下Deployment，慢慢理解上面我们的配置文件为什么要那样子写～</p>
<h2 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h2><p>我们已经知道，Deployment是k8s集群中用来管理Pod生命周期的一种Controller，也是我们最经常使用的一种Controller，我们上面所创建的leaveword-mysql-deployment.yaml以及leaveword-deployment.yaml就是两个Deployment，用于创建对应的Pod。</p>
<p>Deployment可以直接在命令行创建，如直接运行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run nginx-deployment --image=nginx1.7.9 --replicas=2</span><br></pre></td></tr></table></figure>
<p>就可以直接创建一个名称为nginx-deployment，镜像为nginx，副本数量为2的Pod。</p>
<p>但是当参数比较多时，命令行写参数可读性很差，且不易保存。所以我们一般会采用配置文件的方式来定义和创建Deployment，也就是我们上面所使用的方式。接下来，我们以上面的两个Deployment文件为例来说明一下各项配置的作用，建议大家配合官方文档[3]理解：</p>
<p>leaveword-mysql-deployment.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 见下方说明1</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="comment"># 见下方说明2</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="comment"># 里面可以有名字，注释等内容，也可以定义label</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">leaveword-mysql</span></span><br><span class="line"><span class="comment"># Deployment资源的规格说明</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">	<span class="comment"># 见下方说明3</span></span><br><span class="line"><span class="attr">    replicas:</span> <span class="number">1</span></span><br><span class="line">    <span class="comment"># 见下方说明4</span></span><br><span class="line"><span class="attr">    strategy:</span></span><br><span class="line"><span class="attr">        type:</span> <span class="string">Recreate</span></span><br><span class="line">    <span class="comment"># 定义Pod的模板</span></span><br><span class="line"><span class="attr">    template:</span></span><br><span class="line">    	<span class="comment"># 见下方说明5</span></span><br><span class="line"><span class="attr">        metadata:</span></span><br><span class="line"><span class="attr">            labels:</span></span><br><span class="line"><span class="attr">                database:</span> <span class="string">leaveword-mysql</span></span><br><span class="line">        <span class="comment"># Pod的规格说明</span></span><br><span class="line"><span class="attr">        spec:</span></span><br><span class="line"><span class="attr">            containers:</span></span><br><span class="line">            <span class="comment"># 容器启动时的附加参数，此处设置了mysql的字符集</span></span><br><span class="line"><span class="attr">            - args:</span></span><br><span class="line"><span class="bullet">              -</span> <span class="bullet">--character-set-server=utf8mb4</span></span><br><span class="line"><span class="bullet">              -</span> <span class="bullet">--collation-server=utf8mb4_unicode_ci</span></span><br><span class="line">              <span class="comment"># 容器启动时的环境变量，此处设置了新建数据库的名字和连接数据库的密码。</span></span><br><span class="line"><span class="attr">              env:</span></span><br><span class="line"><span class="attr">              - name:</span> <span class="string">MYSQL_DATABASE</span></span><br><span class="line"><span class="attr">                value:</span> <span class="string">leaveword</span></span><br><span class="line"><span class="attr">              - name:</span> <span class="string">MYSQL_ROOT_PASSWORD</span></span><br><span class="line"><span class="attr">                value:</span> <span class="string">root</span></span><br><span class="line">              <span class="comment"># 见下方说明6</span></span><br><span class="line"><span class="attr">              image:</span> <span class="attr">mysql:5.6</span></span><br><span class="line"><span class="attr">              name:</span> <span class="string">leaveword-mysql</span></span><br><span class="line">              <span class="comment"># 见下方说明7</span></span><br><span class="line"><span class="attr">              ports:</span></span><br><span class="line"><span class="attr">              - containerPort:</span> <span class="number">3306</span></span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ol>
<li><p>apiVersion是当前资源所在的api版本。alpha表示可能会包含错误，可能会随时丢弃；beta表示经过测试，功能正常。细节可能会改变，但是功能不会被删除。;stable表示稳定版本。</p>
<p>大概就是一些资源可能刚开始在beta，但是后来慢慢会被加入到stable。比如Deployment就经历了：</p>
<p>1.6之前：extensions/v1beta1</p>
<p>1.6~1.9：apps/v1beta1</p>
<p>1.9后：apps/v1</p>
<p>所以我们现在使用Deployment一般使用apps/v1，偶尔看到extensions/v1beta1或者apps/v1beta1的写法也不要太疑惑，因为这三种写法目前都还能用，但是还是建议大家用稳定版本的即apps/v1，这也是官方推荐写法。</p>
</li>
<li><p>kind后面跟随的是资源的类型，我们在上面新建了deployment和service，实际上还有其它类型的资源，就考kind后面跟随的类型名称来区分。</p>
</li>
<li><p>replicas是控制副本数量的，比如上面的leaveword-mysql replica为1，那么只会开启一个Pod副本，而leaveword的replicas为3，则开启了三个Pod副本，而且集群会自动监控副本数量，如果小于3则会自动创建新的副本，保证数量始终为文件定义的数量。</p>
</li>
<li><p>这个规定的是该deployment的升级策略，Recreate这种策略是一种非常简单的策略，旧的Pod直接被杀死，新的取代旧的。但是这个参数可以被设置为其它类型以满足各种情况下的需要，具体可见参考资料[4]。</p>
</li>
<li><p>这里的metadata仍然是元数据，经常被用来定义labels，label的键值都可以自己设置。用途是为了完成Service和Pod的绑定，根据label就可以筛选出对应的Pod，比如这里的label设置为leaveword-mysql，那么leaveword-mysql-service中selector就可以设置为同样的key:value，这样就能够完成Pod和Service的绑定，而且即使是一对一，一对多，多对多都可以绑定。</p>
</li>
<li><p>image是镜像的名字，Pod启动时，会根据image去拉取相关镜像，比较重要。</p>
</li>
<li><p>设置容器内暴露的端口。注意，这里的端口并不是外界可以访问的端口，即便是集群内部也是无法直接访问的，这个端口仅仅在容器内暴露，原则上来说Pod副本IP+这个端口号可以访问，但是因为Pod IP是动态生成的，而且每个副本的IP也不一样，所以我们一般借助Service定义的端口来进行访问。</p>
</li>
</ol>
<p>下面我们再看一下leaveword的deployment定义文件：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">leaveword</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">leaveword</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">        - image:</span> <span class="string">icedsoul/leaveword</span></span><br><span class="line"><span class="attr">          name:</span> <span class="string">leaveword</span></span><br><span class="line"><span class="attr">          ports:</span></span><br><span class="line"><span class="attr">            - containerPort:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">      restartPolicy:</span> <span class="string">Always</span></span><br></pre></td></tr></table></figure>
<p>基本和上面类似，最后多了一个restartPolicy是指重启策略，字面意思，应该很容易理解。</p>
<p>除了上面的内容之外，deployment还可以有很多其它的标签，具体请以[3]为准。</p>
<h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><p>接下来我们来看一下Service的定义文件：</p>
<p>leaveword-mysql-service.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">group-mysql</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">"3306"</span></span><br><span class="line"><span class="attr">      port:</span> <span class="number">3306</span></span><br><span class="line"><span class="attr">      targetPort:</span> <span class="number">3306</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    database:</span> <span class="string">leaveword-mysql</span></span><br></pre></td></tr></table></figure>
<p>leaveword-service.yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">leaveword-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">NodePort</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">    - name:</span> <span class="string">"8081"</span></span><br><span class="line"><span class="attr">      port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">      targetPort:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">      nodePort:</span> <span class="number">30001</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">leaveword</span></span><br></pre></td></tr></table></figure>
<p>apiVersion、kind、metadata、spec意义都同上，主力需要注意的一点是端口，我们可以注意到的是ports这个标签的不同，leaveword-mysql-service有两个端口号，leaveword-service有三个端口号，接下来我们详细看一下ports这个标签。</p>
<p>ports一共可以定义三种端口：</p>
<ul>
<li>nodePort：暴露给集群外部的端口，比如leaveword-service我们需要在集群外访问这个服务，那么就在这里设置nodePort来暴露端口，而且上面需要添加type: NodePort。但是，外部流量访问集群不只有这一种方式，这也是一种比较有风险的方式，因为是实验系统简单起见所以如此配置。上面的leaveword-mysql-service因为无需对集群外暴露端口，所以不需要设置nodePort。</li>
<li><p>port：暴露给集群内部其它服务的端口号，设置了这个端口那么集群内其它服务就可以通过<br>http://[service-name]:[port]<br>的方式来访问这个服务对应的Pod。上面的两个服务都设置了这个端口。</p>
</li>
<li><p>targetPort：对应于Deployment中容器的端口号，它的含义为kube-proxy会把来自于nodePort和port的流量转发到容器的targetPort，这个应该与定义Pod时设置的容器内应用暴露的端口号一致，否则会转发失败，导致报错。</p>
</li>
</ul>
<p>最后值得一提的一个标签是selector，这个就是用于service和pod的绑定，比如leaveword-mysql-service中的spec.selector与leaveword-mysql-deployment的spec.template.metadata.labels保持一致，leaveword-service的spec.selector与leaveword-deployment的spec.template.metadata.labels保持一致。并且，selector和labels都可以设置多个，可以很方便的进行多对多的映射。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这篇博客主要内容是把一个简单的应用部署到了k8s集群上运行，并且对使用到的deployment和service的配置文件进行了简单的介绍。下一篇博客我们会专门深入Controller，来分别尝试一下Deployment、DaemonSet、NodeSelector、NodeAffinity、PodAffinity、Taints、Tolerations、Job、自定义调度器等，来看一下他们分别有什么特点，在什么场景下比较适合。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li>《Kubernetes 权威指南 第四版 从Docker到Kubernetes实践全接触》 龚正 等 中国工信出版社</li>
<li>《每天五分钟 玩转Kubernetes》 CloudMan 著 清华大学出版社</li>
<li>Kubernetes Deployment：<a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener">https://kubernetes.io/docs/concepts/workloads/controllers/deployment/</a></li>
<li>Kubernetes Deployment Strategies：<a href="https://www.weave.works/blog/kubernetes-deployment-strategies" target="_blank" rel="noopener">https://www.weave.works/blog/kubernetes-deployment-strategies</a></li>
</ol>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Kubernetes/" rel="tag"><i class="fa fa-tag"></i> Kubernetes</a>
          
            <a href="/tags/Pod/" rel="tag"><i class="fa fa-tag"></i> Pod</a>
          
            <a href="/tags/Deployment/" rel="tag"><i class="fa fa-tag"></i> Deployment</a>
          
            <a href="/tags/Service/" rel="tag"><i class="fa fa-tag"></i> Service</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/kubernetes-2.html" rel="next" title="使用Kubeadm搭建Kubernetes 1.15 集群">
                <i class="fa fa-chevron-left"></i> 使用Kubeadm搭建Kubernetes 1.15 集群
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="gitalk-container">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/icon.jpeg" alt="IcedSoul">
            
              <p class="site-author-name" itemprop="name">IcedSoul</p>
              <p class="site-description motion-element" itemprop="description">Nothing here</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">9</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">19</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/IcedSoul" title="GitHub &rarr; https://github.com/IcedSoul" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="/guoxiaofeng_2015@163.com" title="E-Mail &rarr; guoxiaofeng_2015@163.com"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.bewindoweb.com/" title="http://www.bewindoweb.com/" rel="noopener" target="_blank">BEWINDOWEB /技术/APP/二次元</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#系统准备"><span class="nav-number">2.</span> <span class="nav-text">系统准备</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#项目部署运行"><span class="nav-number">3.</span> <span class="nav-text">项目部署运行</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#创建Mysql的Pod和Service"><span class="nav-number">3.1.</span> <span class="nav-text">创建Mysql的Pod和Service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建Leaveword的Pod和Service"><span class="nav-number">3.2.</span> <span class="nav-text">创建Leaveword的Pod和Service</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Deployment"><span class="nav-number">4.</span> <span class="nav-text">Deployment</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Service"><span class="nav-number">5.</span> <span class="nav-text">Service</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">6.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料"><span class="nav-number">7.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">IcedSoul</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
    <span title="站点总字数">99k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
    <span title="站点阅读时长">2:45</span>
  
</div>


  <div class="powered-by">
    行胜于言
  </div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">
    慎言笃行
  </div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
    
  
  <script color="0,0,0" opacity="0.5" zindex="-1" count="99" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=6.7.0"></script>

  <script src="/js/src/motion.js?v=6.7.0"></script>



  
  


  <script src="/js/src/affix.js?v=6.7.0"></script>

  <script src="/js/src/schemes/pisces.js?v=6.7.0"></script>




  
  <script src="/js/src/scrollspy.js?v=6.7.0"></script>
<script src="/js/src/post-details.js?v=6.7.0"></script>



  


  <script src="/js/src/bootstrap.js?v=6.7.0"></script>



  


  
    

<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">



<script src="//cdn.jsdelivr.net/npm/js-md5@0.7.3/src/md5.min.js"></script>

<script>
  var gitalk = new Gitalk({
    clientID: 'bc5dd2274a78305e909f',
    clientSecret: 'f647861bdd9f4224ebb3bc69151537ecd7766bb1',
    repo: 'Gitment',
    owner: 'IcedSoul',
    admin: ['IcedSoul'],
    id: md5(location.pathname),
    distractionFreeMode: 'true'
  });
  gitalk.render('gitalk-container');
</script>

  


  





  
  
  <script>
    
    function addCount(Counter) {
      var $visitors = $('.leancloud_visitors');
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url }) })
        .done(function({ results }) {
          if (results.length > 0) {
            var counter = results[0];
            
            Counter('put', '/classes/Counter/' + counter.objectId, JSON.stringify({ time: { '__op': 'Increment', 'amount': 1 } }))
            
              .done(function() {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.time + 1);
              })
            
              .fail(function ({ responseJSON }) {
                console.log(`Failed to save Visitor num, with error message: ${responseJSON.error}`);
              })
          } else {
            
              var $element = $(document.getElementById(url));
              $element.find('.leancloud-visitors-count').text('Counter not initialized! More info at console err msg.');
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .fail(function ({ responseJSON }) {
          console.log(`LeanCloud Counter Error: ${responseJSON.code} ${responseJSON.error}`);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + 'tAzqQw92n6UcueiKh29dzBk4-gzGzoHsz')
        .done(function({ api_server }) {
          var Counter = function(method, url, data) {
            return $.ajax({
              method: method,
              url: 'https://' + api_server + '/1.1' + url,
              headers: {
                'X-LC-Id': 'tAzqQw92n6UcueiKh29dzBk4-gzGzoHsz',
                'X-LC-Key': 'NlqlQHrdYzWMsBOv3NW7kajj',
                'Content-Type': 'application/json',
              },
              data: data
            });
          };
          
            addCount(Counter);
          
        });
    });
  </script>



  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
